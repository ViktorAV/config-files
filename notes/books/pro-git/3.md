# Ветвление в Git
- [Советы](## Советы)
- [Команды](## Команды)
- [Важно](## Важно)
- [Пример рабочего процесса](## Пример рабочего процесса)
- [Изменение главной ветки](## Изменение главной ветки)
 
Используя ветвление, вы откланяетесь от основной линии разработки и продалжаете работу
независимо от неё.
Понимание и овладение этой функциональностью дает вам уникальный и мощный инструмент, 
который может полностью изменить привычный процесс разработки.
Git хранит свои данные в виде снимков (snapshot). В файл блоб (большой бинарный файл) а
контрольная сумма попадет в индекс.
Когда вы делаете коммит, Git сохраняет его в виде объекта, который содержит указатель на
снимок подготовленных данных: имя автора, email, сообщение и указатель на коммит или коммиты.

Ветка Git это простой перемещаемый указатель на один из коммитов, который содержит 40
символов контрольной суммы SHA-1 коммита.
По умолчанию название основной ветки в Git - master.
Ветка master всегда будет указывать на последний коммит.
Ветка master это такая же ветка как и все остальные.
Специальный указатель HEAD указывает на текущую ветку.

Ветка слежения выполняет слежение за изменениями в удалённом репозитории,
она будет оповещать каждый раз когда выполняется взаимодействие с удалённым репозиторием.
Выглядит она так `remote/branch` = `origin/master`.

В Git есть два способа выполнить изменения из одной ветки в другую.
1. Слияние. Команда __git merge__.
  Она выполняет трёхстороннее слияние между двумя последними снимками.
  После слияния это один и тот-же снимок, отличается только история коммитов.
3. Преобразование. Команда __git rebase__.
  Она берет все коммиты из одной ветки и в том же порядке применяет их к другой ветке.
  Делает историю коммитов чище, она будет выглядеть линейно.
  Преобразование повторяет изменения из одной ветки поверх другой, по порядку изменений.

Работа с удалённым репозиторием, представим:
- Вы выполняете действия в своей локальной ветке `master`.
- Кто-то отправляет __git push__ на удалённый репозиторий и обновляет ветку `master`.
- То ваши истории продолжатся по разному.
- Пока вы не свяжетесь с сервером `origin` ваш указатель `origin/master` останится таким же.

Механизм работы веток:
1. __git branch__ `test` Создание ветки.
2. __git checkout__ `test` Переход в ветку.
3. Делаем изменения в файлах.
4. __git commit__ `-a -m "test message"` Коммитим изменения.
5. Указатель на ветку `test` перемещается вперёд.
6. Ветка `master` указывает на коммит до команды __git checkout__ `test`.
7. Если перейти обратно в ветку `master` изменения `test` выполнят откат.

## Советы
- Для разработки используйте ветку `develop`, когда задача будет выполнена,
  слейте ветку `develop` с `master`.
  Ветка `develop` предназначена для разработки и тестирования.
  Ветка `master` хранит только рабочий и протестированый код.
- Для исправления ошибок используйте ветку `hotfix`.
  Когда ошибка будет исправлена, слейте ветку с основной и удалите ветку `hotfix`.
- Если вы не хотите вводить пароль для Git каждый раз, используйте эту команду:
  __git config__ `--global credential.helper cache`.

## Команды
__git branch__ `name`, `--merged`, `--no-merged`, `-d`, `-D`, `--move`, `--all`
  Создает новую ветку.
  Если запустить без параметров, покажет имеющиеся ветки.
  `name` Название ветки.
  `--merged` Показывает только слитые ветки.
  `--no-merged` Показывает только не слитые ветки.
  `-d` Удаляет ветку.
  `-D` Удаляет не слитую ветку.
  `--move name new` Переименовывает локальную ветку.
  __git push__ `--set-upstream origin branch` Отправляет ветку на удалённый репозиторий.
  __git push__ `--delete branch` Удаляет ветку на удалённом репозитории.
  `-all` Показывает все ветки.
__git checkout__ `name`, `-b`, `--track`, `-u`, `-vv`
  Переходит на ветку.
  `name` Название ветки, если не существует, создаст ветку слежения.
  `-b` Создает ветку.
  `-b name origin/branch` Создает ветку слежения со своим именем.
  `--track origin/branch` Создает ветку слежения.
  `-u origin/branch` Создает ветку слежения, для своей ветки.
  `-vv` Показывает список веток и какие ветки отслеживаются.
__git switch__ `-c`, `name`, `-`
  Переключается на ветку.
  `-c` Создает ветку.
  `name` Название ветки.
  `-` Предыдущая ветка.
__git log__ `-all` `name` 
  Показывает информацию о ветках, не показывает все ветки по умолчанию.
  `-name` Показывает информацию ветки по названию.
  `-all` Показывает информацию о всех ветках.
__git merge__ `name`
  Сливает ветку с основной. (убедитесь что находитесь в ветке `master`)
  Возможно нужно удалить слитую ветку.
  `name` Название ветки.
__git remote__ `show`, `add`
  `show` Показывает список веток из удалённого репозитория. (ссылок)
  `add name url` Добавляет новый удалённый сервер со своим именем.
__git ls-remote__ `remote`
  Показывает список веток из удалённого репозитория.
__git fetch__ `remote`, `-all`
  Получает изменения с удалённого сервера но не производит слияния.
  `-all` Получает данные со всех удалённых серверов.
__git push__ `remote`, `branch`, `--delete`
  Отправит локальные изменения на удалённый сервер.
  Выполняет: `refs/heads/branch:refs/heads/branch`.
  Так же можно использовать: __git push__ `origin branch:branch`.
  `origin --delete branch` Удаляет ветку на удалённом сервере.
__git pull__
  Получает изменения из удалённого сервера.
  Если использовать эту команду, находясь в ветке слежения, он поймет какую ветку нужно обновить.
__git rebase__ `branch`, `--onto`
  Выполняет преобразование ветки `branch` в текущую ветку. (слияние)
  `--onto master b1 b2` Переключается на ветку `b2`, применяет изменения `b1` в `master`.
  

## Важно
- При переключении веток, происходит изменение файлов в рабочем каталоге.
- Изменение веток `master main mainline default` сломает интеграции, службы, скрипты и пр.
- При получении удалённых веток - автоматически создаются ветки слежения.
- Если вы получили ветку слежения (только для чтения) и хотите получить ее редактируемую
  копию, выполните команду: __git merge__ `origin/branch`. __git checkout__ `-b branch origin/branch`.
- Не перемещайте коммиты, которые уже были отправленны в публичный репозиторий.

## Пример рабочего процесса
1. Вы работаете над сайтом.
2. Вы создаёте ветку для новой страницы.
3. Вы работаете в этой ветке.
Вы получаете сообщение с ошибкой на другой странице.
1. Переключаемся на основную ветку.
2. Создаём ветку для исправления ошибки.
3. После тестирования сливаем ветку исправления с основной веткой.
4. Переключаемся в ветку для новой страницы и продолжаем работу.

## Изменение главной ветки
Изменений главной ветки сломает интеграции, службы, скрипты и прочее.
После изменение главной ветки выполните следующие задачи:
- Все проекты, которые зависят от текущего, должны обновить свой код и конфигурацию
- Обновите конфигурацию всех запускаемых тестов.
- Исправьте скрипты сборки и публикации артефактов.
- Поправьте настройки удалённого репозитория: задайте новую ветку по умолчанию,
  обновите правила слияния, и прочие настройки зависящие от имени ветки.
- Обновите документацию, исправив ссылки старой ветки.
- Слейте или отмените слияния для старой ветки.
- Удалите старую ветку: __git push__ `origin --delete master`.
