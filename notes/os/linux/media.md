# Устройства хранения Linux
- [Устройства и их определение](## Устройства)
- [Монтирование](## mount)
- [Файл fstab](## Файл fstab) 
- [Создание разделов файловой системы fdisk](## fdisk)
- [Создание файловой системы mkfs](## mksf)
- [Очистка диска и создание образа wodim](## wodim)
- [Запись блочных данных dd](## dd)
- [Создание файла образа genisoimage](## genisoimage)

__Поддерживаемые устройства хранения__
- Жёсткие диски
- Сетевые хранилища
- Виртуальные устройства
  - RAID (Redundant Array of Independent Disks)
  - LVM (Logical Master Volume)
   
__Поддерживаемые__ [команды](commands)
- `mount` Смонтировать файловую систему
- `umount` Размонтировать файловую систему
- `fsck` Устранение ошибок в файловой системе
- `fdisk` Программа для работы с таблицей файловой системы
- `mkfs` Создать файловую систему
- `dd` Записывает блоки данных в устройство
- `genisoimage`, `mkisofs` создает файл образа ISO 9660
- `wodim`, `cdrecord` Записывает данные на носитель
- `md5sum` Проверяет контрольную сумму md5
- `df` Вывести смонтированые устройства и другую информацию

## Устройства
Находятся в `/dev`
__Шаблоны именования устройств__
- `fd*` Приводы гибких дисков
- `hd*` Диски IDE (PATA) в старых системах
- `lp*` Принтеры
- `sd*` Диски SCSI
  (жёсткие диски SATA/PATA, флеш-диски, usb)
- `sr*` Оптические диски CD/DVD
Символьные ссылки на устройства `cdrom, dvd, floppy`
__Определение устройств при их подключении__
1. `sudo tail -f /var/log/messages` 
2. Подключи устройство
3. Ищи в логах

## Файл fstab
Файл `/etc/fstab` содержит список устройств, монтируемых при загрузке.
```bash
#Устройство	#Точка монт.	#Тип	#Параметры   #Частота и порядок
LABEL=/12	/		ext4	defaults	1 1
LABEL=/home	/home		ext4	defaults	1 2
LABEL=/boot	/boot		ext4	defaults 	1 2
proc		/proc		proc	defaults	0 0
```
1. Фактическое имя файла устройства, или текстовая метка
2. Каталог в файловой системе к которому подключается устройство
3. Тип файловой системы
4. Параметры (например только для чтения и другие ограничения)
5. Число определяющее когда должно выполнятся резервное копирование
6. Порядок проверки командной __fsck__
При загрузке системы проверяется целостность файловых систем,
перед их монтированием, эту проверку выполняет команда __fsck__
Синтаксис `fsck /dev/sdb`

## dd
Программа копирования блока данных (Data Definition)
Синтаксис `dd if=входной_файл of=выходной_файл bs=Размер_блока count=n`
Скопировать содержимое первого диска на второй
`dd if=/dev/sdb of=/dev/sdc`
Скопировать содержимое диска в файл, например для восстановления системы
`dd if=/dev/sdb of=flash_drive.img`
Создаём ISO образ имеющегося компакт диска
`dd if=/dev/cdrom debian.iso`

## genisoimage
Создание ISO образа из каталога
Синтаксис `genisoimage -o image.iso -R -J ~/files_folder`
- `-R` требует добавить метаданные расширений Rock Ridge
  Разрешающим использовать длинные имена файлов и права
  доступа к файлам в стиле POSIX
- `-J` Тоже что и `-R` но для виндовс

## wodim
Очистка диска и запись образа программой wodim
Синтаксис `wodim dev=/dev/cdrw blank=fast`
Опция `blank` указывает на метод очистки
Записать образ
`wodim dev=/dev/cdrw image.iso`

## fdisk
Программа __fdisk__ позволяет выполнять низкоуровневые операции с:
- Жёсткими дисками
- Флеш дисками
Этим инструментом можно изменять, удалять и создавать разделы.
Перед использованием необходимо размонтировать файловую систему.
Синтаксис `fdisk /dev/sdb` (без номера раздела)
Команды __fdisk__
`a` Изменить флаг загрузочного раздела
`b` Изменить вложенную BSD-метку диска
`c` Переключить флаг совместимости с DOS
`d` Удалить раздел
`l` Список типов разделов
`m` Показать это меню
`n` Добавить новый раздел
`p` Показать таблицу разделов
`q` Выйти без сохранения изменений
`s` Создать новую, пустую таблицу разделов Sun
`t` Изменить тип раздела
`u` Изменить единицы отображения ввода и вывода
`v` Проверить таблицу разделов
`w` Сохранить таблицу на диск и выйти
`x` Дополнительные функции (для экспертов)

Первое что нужно сделать это исследовать список доступных разделов
Командной `p` она выведет таблицу разделов на устройстве.
```bash
Disk /dev/sdb: 16MB, 16006656 bytes
1 heads, 32 sectors/track, 1008 cylinders
Units = cylinders of 31 * 512 = 15872 bytes

Device Boot	Start	End	Blocks	Id	System
/dev/sdb1	    2  1008	15608+   b	W95 FAT32
```

## mkfs
После создания разделов можно переходить к созданию файловой системы.
Программа __mkfs__ создает и форматирует файловые системы (make filesystem)
Синтаксис `mkfs -t ext4 /dev/sdb1`

## mount
Для монтирования файловых систем используется команда __mount__
Синтаксис `mount -t type device dir`
Если вызвать ее без параметров, она выведет список всех файловых
систем, смонтированных в настоящий момент.
```bash
proc on /proc type proc (rw,nosuid,nodev,noexec,relatime)
sysfs on /sys type sysfs (rw,nosuid,nodev,noexec,relatime,seclabel)
devtmpfs on /dev type devtmpfs (rw,nosuid,seclabel,size=4096k,nr_inodes=1048576,mode=755,inode64)
securityfs on /sys/kernel/security type securityfs (rw,nosuid,nodev,noexec,relatime)
```
Вывод имеет следующий формат:
`устройство on точка_монтирования type тип_файловой системы (параметры)`

Точка монтирования - это обычный каталог в файловой системе и
он не обязательно должен быть пустым.
Перед монтированием нужно выполнить размонтирование чтобы
обезопасить файловую систему и сохранить её изменения.
Размонтирование извлекает из ОЗУ данные и сохраняет их на устройстве.
Выполняя размонтирование мы не должны использовать этот каталог.

Монтируем устройство в нашу точку монтирования:
`mount -t ext4 /dev/sdc /mnt/new`
Монтируем ISO образ в дерево файловой системы
`mount -t iso9660 -o loop image.iso /mnt/iso_image`

